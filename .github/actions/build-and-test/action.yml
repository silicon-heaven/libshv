name: Build and test
description: "Build the project and run tests via CMake"

runs:
  using: "composite"
  steps:
    - name: Build
      run: cmake --build '${{github.workspace}}/build' --parallel "$(nproc)"
      shell: bash

    - name: Test
      working-directory: '${{github.workspace}}/build'
      run: |
        # https://github.com/DiligentGraphics/github-action/commit/d2f7990b16def1efa337e5cc2fc8fa22b6fae55d
        PATH="/c/mingw64/bin:$PATH"
        ctest --output-on-failure -j"$(nproc)"
      shell: bash
